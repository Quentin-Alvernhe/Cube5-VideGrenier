{% set extra_css = '/style/forgot-password.css' %}
{% extends "base.html" %}
{% block title %}Nouveau mot de passe{% endblock %}
{% block body %}
    <div class="centered-form-wrapper">
        <div class="centered-form">
            <form method="post">
                {# Champ de saisie pour le nouveau mot de passe#}
                <div class="form-group position-relative">
                    <label for="password">Mot de passe</label>
                    <div class="input-group" style="display:flex; flex-direction: row;">
                        {# Icône pour afficher/masquer le mot de passe #}
                        <input type="password"
                               class="form-control"
                               id="password"
                               name="password"
                               placeholder="**********"
                               required>
                        <span class="input-group-text" onclick="togglePasswordVisibility('password', this)" style="cursor:pointer; margin: 3px; align-content: center;">
                                    <i class="fa fa-eye-slash"></i>
                                </span>
                    </div>
                </div>

                {# Confirmation du mot de passe #}
                <div class="form-group position-relative">
                    <label for="password-confirm">Confirmez le mot de passe</label>
                    <div class="input-group" style="display:flex; flex-direction: row;">
                        <input type="password"
                               class="form-control"
                               id="password-confirm"
                               name="password_confirmation"
                               placeholder="**********"
                               required>
                        <span class="input-group-text" onclick="togglePasswordVisibility('password-confirm', this)" style="cursor:pointer; margin: 3px; align-content: center;">
                                    <i class="fa fa-eye-slash"></i>
                                </span>
                    </div>
                </div>

                {# Message d’erreur si les mots de passe ne correspondent pas #}
                {% if error %}<p style="color:red">{{ error }}</p>{% endif %}
                <div id="password-rules" class="small">
                    <p id="length" class="text-danger">• Minimum 8 caractères</p>
                    <p id="upper" class="text-danger">• Une lettre majuscule</p>
                    <p id="lower" class="text-danger">• Une lettre minuscule</p>
                    <p id="number" class="text-danger">• Un chiffre</p>
                    <p id="special" class="text-danger">• Un caractère spécial</p>
                </div>
                <button type="submit">Changer</button>
            </form>
        </div>
    </div>

<script>
    // On cible les règles de mot de passe pour mise à jour dynamique
    const password = document.getElementById('password');
    const rules = {
        length: document.getElementById('length'),
        upper: document.getElementById('upper'),
        lower: document.getElementById('lower'),
        number: document.getElementById('number'),
        special: document.getElementById('special')
    };

    // Écouteur sur le champ password : on valide les règles en temps réel
    password.addEventListener('input', function () {
        const val = password.value;
        rules.length.className = val.length >= 8 ? 'text-success' : 'text-danger';
        rules.upper.className = /[A-Z]/.test(val) ? 'text-success' : 'text-danger';
        rules.lower.className = /[a-z]/.test(val) ? 'text-success' : 'text-danger';
        rules.number.className = /\d/.test(val) ? 'text-success' : 'text-danger';
        rules.special.className = /[\W_]/.test(val) ? 'text-success' : 'text-danger';
    });

    // Fonction pour basculer la visibilité du mot de passe
    function togglePasswordVisibility(fieldId, eyeIcon) {
        const input = document.getElementById(fieldId);
        const isPassword = input.type === "password";
        input.type = isPassword ? "text" : "password";
        eyeIcon.innerHTML = isPassword
            ? `<i class="fa fa-eye"></i>`
            : `<i class="fa fa-eye-slash"></i>`;
    }

</script>
{% endblock %}
